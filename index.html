<!DOCTYPE html>

<html>
<body style="margin: 0; padding: 0;">
  <canvas id="myCanvas"></canvas>
  <audio id="myAudio" ></audio>

<script>
document.body.scrollTop = 0; // <-- pull the page to the top
document.body.style.overflow = 'hidden'; // <-- To hide scrollbar

var canvas = document.getElementById('myCanvas');
var ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var dataArray;
var analyser;

function draw(){
  analyser.getByteTimeDomainData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  //console.log(dataArray[dataArray.length/2]);

  for(var i = 0; i<dataArray.length; i++){
    if(canvas.width <= dataArray.length){
      ctx.fillRect(i * (dataArray.length/canvas.width), dataArray[i] / 128.0 * canvas.height / 2 , 2, 2);
    }else{
      ctx.fillRect(i * (canvas.width/dataArray.length), dataArray[i] / 128.0 * canvas.height / 2 , 2, 2);
    }

  }

  //console.log("hi")
  requestAnimationFrame(draw);
}



navigator.mediaDevices.getDisplayMedia({video: true, audio: true}).then(function(stream){
  audioStreams = stream.getAudioTracks();
  console.log(audioStreams);
  //document.getElementById("myAudio").srcObject = stream;

  var audioCtx = new AudioContext();
  analyser = audioCtx.createAnalyser();
  analyser.minDecibels = -90;
  analyser.maxDecibels = -10;
  analyser.smoothingTimeConstant = 0.85;
  analyser.fftSize = 1024;  //default 2048

  var bufferLength = analyser.frequencyBinCount;
  dataArray = new Uint8Array(bufferLength);
  console.log(dataArray.length);

  audioSource = audioCtx.createMediaStreamSource(stream);

  audioSource.connect(analyser);
  //analyser.connect(audioCtx.destination);

  requestAnimationFrame(draw);
});

window.addEventListener("resize", function(){
  console.log("yeet");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
})




</script>
</body>
</html>
